<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Inventaris Lab Komputer 2</title>

<style>
body{
    font-family: Calibri, sans-serif;
    background:#f4f7fb;
    margin:0;
}

/* ===== HEADER ===== */
.top-header {
    display:flex;
    align-items:center;
    gap:15px;
    background:#2563eb;
    padding:15px 20px;
    border-radius:0 0 15px 15px;
    box-shadow:0 3px 8px rgba(0,0,0,.3);
    color:white;
}
.top-header img{
    height:50px;width:50px;
    border-radius:10px;
    background:white;
}
.top-header h1{margin:0;font-size:20px;}
.top-header p{margin:0;font-size:12px;color:#e0e7ff;}

/* ===== SUMMARY ===== */
.summary-section{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:14px;
    margin:20px;
}
.summary-card{
    background:white;
    border-radius:14px;
    padding:16px;
    display:flex;
    align-items:center;
    gap:14px;
    box-shadow:0 4px 10px rgba(0,0,0,.08);
}
.summary-card .icon{font-size:30px;}
.summary-card .value{font-size:26px;font-weight:bold;}
.summary-card .label{font-size:13px;color:#6b7280;}
.summary-card.total{border-left:6px solid #2563eb;}
.summary-card.normal{border-left:6px solid #16a34a;}
.summary-card.ringan{border-left:6px solid #facc15;}
.summary-card.berat{border-left:6px solid #dc2626;}
.summary-card.windows{border-left:6px solid #0284c7;}
.summary-card.chromebook{border-left:6px solid #0d9488;}

/* ===== MAP ===== */
h2{margin:20px;color:#2563eb;}
#mapGrid{
    display:grid;
    gap:6px;
    margin:0 20px 30px;
}
.meja{
    height:45px;
    border-radius:6px;
    font-weight:bold;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
}
.normal{background:#28a745;color:white;}
.ringan{background:#ffc107;color:black;}
.berat{background:#dc3545;color:white;}
.kosong{background:transparent;cursor:default;}

/* ===== DETAIL ===== */
#detailBox{
    background:white;
    width:380px;
    padding:18px;
    border-radius:8px;
    box-shadow:0 3px 8px rgba(0,0,0,.25);
    display:none;
    margin:0 20px 30px;
}
#detailBox h3{
    margin-top:0;
    color:#2563eb;
    border-left:6px solid #facc15;
    padding-left:8px;
}
.fade-img{
    animation:fadeIn .8s ease forwards;
    opacity:0;
}
@keyframes fadeIn{
    from{opacity:0;transform:scale(.95)}
    to{opacity:1;transform:scale(1)}
}
</style>
</head>

<body>

<header class="top-header">
    <img src="assets/logo.jpg">
    <div>
        <h1>Dashboard Inventaris Lab Komputer 2</h1>
        <p>Versi 1.0 ¬∑ Data Google Sheet</p>
    </div>
</header>

<section class="summary-section">
    <div class="summary-card total"><div class="icon">üíª</div><div><div id="totalLaptop" class="value">0</div><div class="label">Total Laptop</div></div></div>
    <div class="summary-card normal"><div class="icon">‚úÖ</div><div><div id="normalCount" class="value">0</div><div class="label">Normal</div></div></div>
    <div class="summary-card ringan"><div class="icon">‚ö†Ô∏è</div><div><div id="ringanCount" class="value">0</div><div class="label">Rusak Ringan</div></div></div>
    <div class="summary-card berat"><div class="icon">‚ùå</div><div><div id="beratCount" class="value">0</div><div class="label">Rusak Berat</div></div></div>
    <div class="summary-card windows"><div class="icon">ü™ü</div><div><div id="windowsCount" class="value">0</div><div class="label">Windows</div></div></div>
    <div class="summary-card chromebook"><div class="icon">üåê</div><div><div id="chromebookCount" class="value">0</div><div class="label">Chromebook</div></div></div>
</section>

<h2>üìç Denah Meja Lab</h2>
<div id="mapGrid"></div>
<div id="detailBox"></div>

<script>
const SHEET_ID = "14Trwaf9K__WczN1hARNDSeL0knx5KCxA";
let INV=[], MAP=[];

async function loadSheet(sheet){
    const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheet}&tqx=out:json`;
    const res=await fetch(url);
    const txt=await res.text();
    const json=JSON.parse(txt.substring(47).slice(0,-2));
    const headers=json.table.cols.map(c=>c.label);
    return json.table.rows.map(r=>{
        let o={};
        r.c.forEach((c,i)=>o[headers[i]]=c?c.v:"");
        return o;
    });
}

async function init(){
    INV=await loadSheet("INV");
    MAP=await loadSheet("MAP");
    updateSummary();
    renderMap();
}
init();

function updateSummary(){
    totalLaptop.textContent=INV.length;
    normalCount.textContent=INV.filter(x=>(x.Kondisi||"").toLowerCase()=="normal").length;
    ringanCount.textContent=INV.filter(x=>(x.Kondisi||"").toLowerCase().includes("ringan")).length;
    beratCount.textContent=INV.filter(x=>(x.Kondisi||"").toLowerCase().includes("berat")).length;
    windowsCount.textContent=INV.filter(x=>(x.OS||"").toLowerCase().includes("windows")).length;
    chromebookCount.textContent=INV.filter(x=>(x.OS||"").toLowerCase().includes("chrome")).length;
}

function renderMap(){
    const grid=document.getElementById("mapGrid");
    grid.innerHTML="";
    const maxRow=Math.max(...MAP.map(m=>+m.ROW));
    const maxCol=Math.max(...MAP.map(m=>+m.COL));
    grid.style.gridTemplateColumns=`repeat(${maxCol},55px)`;

    for(let r=1;r<=maxRow;r++){
        for(let c=1;c<=maxCol;c++){
            const m=MAP.find(x=>x.ROW==r && x.COL==c);
            const d=document.createElement("div");
            if(!m || !m["NO MEJA"]){d.className="meja kosong";grid.appendChild(d);continue;}
            const inv=INV.find(i=>i["NO MEJA"]==m["NO MEJA"]);
            let cls="normal";
            if(inv){
                const k=(inv.Kondisi||"").toLowerCase();
                if(k.includes("ringan"))cls="ringan";
                else if(k.includes("berat"))cls="berat";
            }
            d.className=`meja ${cls}`;
            d.textContent=m["NO MEJA"];
            if(inv)d.onclick=()=>showDetail(inv);
            grid.appendChild(d);
        }
    }
}

function showDetail(item){
    const box=document.getElementById("detailBox");
    let img="";
    const tipe=(item["Merek / Tipe"]||"").toLowerCase();
    if(tipe.includes("axio")) img="https://yanuar-moga.github.io/escape/assets/AXIO_L19B.png";
    else if(tipe.includes("chrome")) img="https://yanuar-moga.github.io/escape/assets/LENOVO_IDEAPAD_110_14LBR.png";

    box.style.display="block";
    box.innerHTML=`
    <h3>Meja ${item["NO MEJA"]}</h3>
    ${img?`<div style="text-align:center"><img class="fade-img" src="${img}" width="160"></div>`:""}
    <b>No Inventaris:</b> ${item["No Inventaris"]}<br>
    <b>Merek / Tipe:</b> ${item["Merek / Tipe"]}<br>
    <b>Processor:</b> ${item.Processor}<br>
    <b>RAM:</b> ${item.RAM}<br>
    <b>Storage:</b> ${item.Storage}<br>
    <b>Layar:</b> ${item.Layar}<br>
    <b>OS:</b> ${item.OS}<br><br>
    <b>Kondisi:</b> ${item.Kondisi}<br>
    <b>Keterangan:</b> ${item.Keterangan}<br>
    <b>Tindak Lanjut:</b> ${item["Tindak Lanjut"]}<br>`;
}
</script>

</body>
</html>
