<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Inventaris Lab Komputer 2</title>

<style>
body{
    font-family: Calibri, sans-serif;
    background:#f4f7fb;
    margin:0;
    padding:20px;
}

/* HEADER */
.header{
    background:#0056b3;
    color:white;
    font-size:28px;
    font-weight:bold;
    padding:15px 25px;
    border-left:10px solid #ffcc00;
    border-radius:6px;
    width:fit-content;
}

/* DASHBOARD */
.card-container{
    display:grid;
    grid-template-columns:repeat(3,260px);
    gap:15px;
    margin-top:20px;
}

.card{
    background:white;
    padding:15px;
    border-radius:8px;
    box-shadow:0 3px 6px rgba(0,0,0,.15);
    border-left:6px solid #ffcc00;
    font-size:18px;
}

.card-title{
    font-weight:bold;
    color:#0056b3;
}

/* MAP */
#mapGrid{
    display:grid;
    grid-template-columns:repeat(11,55px);
    gap:6px;
    margin-top:25px;
    margin-bottom:40px;
}

.meja{
    width:55px;
    height:45px;
    border-radius:6px;
    font-weight:bold;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
}

.normal{background:#28a745;color:white;}
.ringan{background:#ffc107;color:black;}
.berat{background:#dc3545;color:white;}
.kosong{background:transparent;border:none;cursor:default;}

/* DETAIL */
#detailBox{
    background:white;
    width:380px;
    padding:18px;
    border-radius:8px;
    box-shadow:0 3px 8px rgba(0,0,0,.25);
    display:none;
}

#detailBox h3{
    margin-top:0;
    color:#0056b3;
    border-left:6px solid #ffcc00;
    padding-left:8px;
}

/* IMAGE ANIMATION */
.fade-img{
    animation:fadeIn .8s ease forwards;
    opacity:0;
}

@keyframes fadeIn{
    from{opacity:0;transform:scale(.95)}
    to{opacity:1;transform:scale(1)}
}
</style>
</head>

<body>

<div class="header">üìò Dashboard Inventaris Lab Komputer 2</div>

<!-- DASHBOARD -->
<div class="card-container">
    <div class="card"><div class="card-title">Total Perangkat</div><span id="totalPerangkat">-</span></div>
    <div class="card"><div class="card-title">Windows</div><span id="totalWindows">-</span></div>
    <div class="card"><div class="card-title">Chromebook</div><span id="totalChromebook">-</span></div>

    <div class="card"><div class="card-title">Normal</div><span id="normalCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Ringan</div><span id="ringanCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Berat</div><span id="beratCount">-</span></div>

    <div class="card"><div class="card-title">Butuh Mouse</div><span id="mouseNeed">-</span></div>
    <div class="card"><div class="card-title">Butuh Keyboard</div><span id="keyboardNeed">-</span></div>
</div>

<h2 style="color:#0056b3;margin-top:35px;">üìç Peta Meja Lab</h2>

<div id="mapGrid"></div>
<div id="detailBox"></div>

<script>
let INV = [];

/* LOAD GOOGLE SHEETS */
async function loadGSheet(){
    const url = "https://docs.google.com/spreadsheets/d/14Trwaf9K__WczN1hARNDSeL0knx5KCxA/gviz/tq?tqx=out:json";
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substring(47).slice(0,-2));

    const headers = json.table.cols.map(c => c.label);
    INV = json.table.rows.map(r=>{
        let obj={};
        r.c.forEach((cell,i)=>{
            obj[headers[i]] = cell ? cell.v : "";
        });
        return obj;
    });

    updateDashboard();
    renderMap();
}
loadGSheet();

/* DASHBOARD */
function updateDashboard(){
    const win = INV.filter(x => (x.OS||"").toLowerCase().includes("windows"));
    const chrome = INV.filter(x => (x.OS||"").toLowerCase().includes("chrome"));

    const normal = INV.filter(x => (x.Kondisi||"").toLowerCase()==="normal");
    const ringan = INV.filter(x => (x.Kondisi||"").toLowerCase().includes("ringan"));
    const berat = INV.filter(x => (x.Kondisi||"").toLowerCase().includes("berat"));

    const mouse = INV.filter(x => (x.Mouse||"").toLowerCase()==="tidak");
    const keyboard = INV.filter(x => (x.Keyboard||"").toLowerCase()==="tidak");

    totalPerangkat.innerText = INV.length;
    totalWindows.innerText = win.length;
    totalChromebook.innerText = chrome.length;
    normalCount.innerText = normal.length;
    ringanCount.innerText = ringan.length;
    beratCount.innerText = berat.length;
    mouseNeed.innerText = mouse.length;
    keyboardNeed.innerText = keyboard.length;
}

/* MAP */
function renderMap(){
    const grid = document.getElementById("mapGrid");
    grid.innerHTML="";

    const rows=[
        [22,21,20,19,18,17,"",4,3,2,1],
        [28,27,26,25,24,23,"",8,7,6,5],
        [34,33,32,31,30,29,"",12,11,10,9],
        [40,39,38,37,36,35,"",16,15,14,13]
    ];

    rows.forEach(r=>{
        r.forEach(no=>{
            const d=document.createElement("div");
            if(no===""){d.className="meja kosong";grid.appendChild(d);return;}

            const item=INV.find(x=>Number(x["NO MEJA"])===Number(no));
            let cls="kosong";
            if(item){
                const k=(item.Kondisi||"").toLowerCase();
                if(k==="normal")cls="normal";
                else if(k.includes("ringan"))cls="ringan";
                else if(k.includes("berat"))cls="berat";
            }

            d.className=`meja ${cls}`;
            d.textContent=no;
            if(item)d.onclick=()=>showDetail(no);
            grid.appendChild(d);
        });
    });
}

/* DETAIL */
function showDetail(no){
    const box=document.getElementById("detailBox");
    const item=INV.find(x=>String(x["NO MEJA"])===String(no));
    box.style.display="block";

    if(!item){
        box.innerHTML=`<h3>Meja ${no}</h3>Data tidak ditemukan`;
        return;
    }

    const tipe=(item["Merek / Tipe"]||"").toLowerCase();
    let img="";

    if(tipe.includes("axio")){
        img="https://yanuar-moga.github.io/escape/assets/AXIO_L19B.png";
    }else if(tipe.includes("chrome")){
        img="https://yanuar-moga.github.io/escape/assets/LENOVO_IDEAPAD_110_14LBR.png";
    }

    box.innerHTML=`
        <h3>Detail Meja ${no}</h3>
        ${img?`<div style="text-align:center">
            <img class="fade-img" src="${img}" width="160">
        </div>`:""}

        <b>No Inventaris:</b> ${item["No Inventaris"]}<br>
        <b>Merek / Tipe:</b> ${item["Merek / Tipe"]}<br>
        <b>Processor:</b> ${item.Processor}<br>
        <b>RAM:</b> ${item.RAM}<br>
        <b>Storage:</b> ${item.Storage}<br>
        <b>Layar:</b> ${item.Layar}<br>
        <b>OS:</b> ${item.OS}<br><br>

        <b>Kondisi:</b> ${item.Kondisi}<br>
        <b>Keterangan:</b> ${item.Keterangan}<br>
        <b>Mouse:</b> ${item.Mouse}<br>
        <b>Keyboard:</b> ${item.Keyboard}<br>
        <b>Tindak Lanjut:</b> ${item["Tindak Lanjut"]}<br>
    `;
}
</script>

</body>
</html>
