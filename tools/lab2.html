<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Inventaris Laptop Lab 2</title>

<style>
body{
    margin:0;
    font-family: "Segoe UI", Arial, sans-serif;
    background:#f1f5f9;
    color:#1e293b;
}

/* ================= HEADER ================= */
.top-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #2563eb;
    padding: 14px 20px;
    border-radius: 0 0 16px 16px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.25);
    color: #fff;
}
.header-left {
    display: flex;
    align-items: center;
    gap: 14px;
}
.top-header img {
    height: 48px;
    width: 48px;
    border-radius: 10px;
    background: #fff;
    padding: 4px;
}
.header-text h1 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
}
.header-text p {
    margin: 0;
    font-size: 12px;
    color: #e0e7ff;
}
.badge {
    background: rgba(255,255,255,0.15);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
}

/* ================= LAYOUT ================= */
.container{
    padding:20px;
    max-width:1200px;
    margin:auto;
}

/* ================= SUMMARY ================= */
.summary{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:15px;
    margin-bottom:25px;
}
.card{
    background:#fff;
    padding:15px;
    border-radius:14px;
    box-shadow:0 4px 10px rgba(0,0,0,.08);
}
.card h3{
    margin:0;
    font-size:14px;
    color:#64748b;
}
.card span{
    font-size:28px;
    font-weight:700;
}

/* ================= MAP ================= */
.map-wrapper{
    background:#fff;
    padding:20px;
    border-radius:16px;
    box-shadow:0 4px 10px rgba(0,0,0,.1);
}
.map-title{
    font-weight:600;
    margin-bottom:10px;
}
.map-grid{
    display:grid;
    gap:8px;
    justify-content:start;
}

/* meja */
.meja{
    width:55px;
    height:55px;
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
    cursor:pointer;
    box-shadow:0 3px 6px rgba(0,0,0,.15);
}
.normal{ background:#22c55e; color:#fff; }
.ringan{ background:#facc15; }
.berat{ background:#ef4444; color:#fff; }
.kosong{ visibility:hidden; }

/* ================= MODAL ================= */
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.5);
    display:none;
    align-items:center;
    justify-content:center;
}
.modal-box{
    background:#fff;
    padding:20px;
    border-radius:14px;
    width:300px;
}
.modal-box h3{ margin-top:0; }
.modal-box button{
    margin-top:10px;
    padding:8px 12px;
    border:none;
    background:#2563eb;
    color:#fff;
    border-radius:8px;
    cursor:pointer;
}
</style>
</head>

<body>

<header class="top-header">
  <div class="header-left">
    <img src="assets/logo.jpg">
    <div class="header-text">
      <h1>Dashboard Inventaris Laptop</h1>
      <p>Lab Komputer 2 Â· Google Sheet</p>
    </div>
  </div>
  <span class="badge">v1.0</span>
</header>

<div class="container">

<!-- SUMMARY -->
<div class="summary">
    <div class="card"><h3>Total Laptop</h3><span id="tTotal">0</span></div>
    <div class="card"><h3>Kondisi Normal</h3><span id="tNormal">0</span></div>
    <div class="card"><h3>Rusak Ringan</h3><span id="tRingan">0</span></div>
    <div class="card"><h3>Rusak Berat</h3><span id="tBerat">0</span></div>
</div>

<!-- MAP -->
<div class="map-wrapper">
    <div class="map-title">Denah Meja Laptop Lab 2</div>
    <div class="map-grid" id="mapGrid"></div>
</div>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h3>Detail Laptop</h3>
    <div id="modalContent"></div>
    <button onclick="closeModal()">Tutup</button>
  </div>
</div>

<script>
const SHEET_ID = "14Trwaf9K__WczN1hARNDSeL0knx5KCxA";
const INV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=INV`;
const MAP_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=MAP`;

let INV=[], MAP=[];

/* ================= LOAD DATA ================= */
fetch(INV_URL).then(r=>r.text()).then(t=>{
    INV = parseGVIZ(t);
    renderSummary();
});

fetch(MAP_URL).then(r=>r.text()).then(t=>{
    MAP = parseGVIZ(t);
    renderMap();
});

/* ================= FUNCTIONS ================= */
function parseGVIZ(txt){
    const json = JSON.parse(txt.substring(47, txt.length-2));
    const cols = json.table.cols.map(c=>c.label);
    return json.table.rows.map(r=>{
        let o={};
        r.c.forEach((v,i)=>o[cols[i]]=v?v.v:"");
        return o;
    });
}

function renderSummary(){
    document.getElementById("tTotal").textContent = INV.length;
    document.getElementById("tNormal").textContent = INV.filter(i=>i.Kondisi==="Normal").length;
    document.getElementById("tRingan").textContent = INV.filter(i=>i.Kondisi==="Rusak Ringan").length;
    document.getElementById("tBerat").textContent = INV.filter(i=>i.Kondisi==="Rusak Berat").length;
}

function renderMap(){
    const grid = document.getElementById("mapGrid");
    grid.innerHTML="";

    const rows = MAP.map(r=>Object.values(r));
    const maxCol = Math.max(...rows.map(r=>r.length));
    grid.style.gridTemplateColumns = `repeat(${maxCol},55px)`;

    rows.forEach(row=>{
        row.forEach(cell=>{
            if(!cell){
                const d=document.createElement("div");
                d.className="meja kosong";
                grid.appendChild(d);
                return;
            }

            const inv = INV.find(i=>String(i["NO MEJA"])===String(cell));
            let cls="normal";
            if(inv){
                if(inv.Kondisi==="Rusak Ringan") cls="ringan";
                if(inv.Kondisi==="Rusak Berat") cls="berat";
            }

            const d=document.createElement("div");
            d.className=`meja ${cls}`;
            d.textContent=cell;
            if(inv) d.onclick=()=>showDetail(inv);
            grid.appendChild(d);
        });
    });
}

function showDetail(inv){
    document.getElementById("modalContent").innerHTML=`
        <b>No Meja:</b> ${inv["NO MEJA"]}<br>
        <b>Inventaris:</b> ${inv["NAMA BARANG"]||"-"}<br>
        <b>Kondisi:</b> ${inv.Kondisi}<br>
        <b>Keterangan:</b> ${inv.Keterangan||"-"}
    `;
    document.getElementById("modal").style.display="flex";
}
function closeModal(){
    document.getElementById("modal").style.display="none";
}
</script>

</body>
</html>
