<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Inventaris Lab Komputer 2</title>

<style>
    body {
        font-family: 'Calibri', sans-serif;
        background: #f4f7fb;
        padding: 20px;
        margin: 0;
    }

    .header {
        background: #0056b3;
        padding: 15px 25px;
        color: white;
        font-size: 28px;
        font-weight: bold;
        border-left: 10px solid #ffcc00;
        width: fit-content;
        border-radius: 5px;
    }

    .card-container {
        display: grid;
        grid-template-columns: repeat(3, 260px);
        gap: 15px;
        margin-top: 20px;
    }

    .card {
        background: white;
        border-left: 6px solid #ffcc00;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        font-size: 18px;
    }

    .card-title {
        color: #0056b3;
        font-weight: bold;
    }

    #mapGrid {
        display: grid;
        grid-template-columns: repeat(11, 55px);
        gap: 6px;
        margin-top: 30px;
        margin-bottom: 40px;
    }

    .meja {
        width: 55px;
        height: 45px;
        border-radius: 6px;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }

    .normal { background: #28a745; color: white; }
    .ringan { background: #ffc107; color: black; }
    .berat  { background: #dc3545; color: white; }
    .marked { background: #7a00ff !important; color:white !important; }

    .kosong {
        background: transparent;
        border: none;
        cursor: default;
    }

    #detailBox {
        background: white;
        width: 360px;
        padding: 18px;
        border-radius: 8px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        display: none;
        position: absolute;
        top: 120px;
        left: 30px;
        z-index: 10;
    }

    #detailBox h3 {
        margin-top: 0;
        color: #0056b3;
        border-left: 6px solid #ffcc00;
        padding-left: 8px;
    }

    .fade-img {
        animation: fadeIn 0.8s ease forwards;
        opacity: 0;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to   { opacity: 1; transform: scale(1); }
    }

    .btn {
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
        border: 1px solid #0056b3;
        margin-top: 15px;
        background: white;
        color: #0056b3;
        font-weight: bold;
    }
</style>
</head>
<body>

<div class="header">Dashboard Inventaris Lab Komputer</div>

<button id="resetMark" class="btn" style="border-color:#ff3399;color:#ff3399;">Reset Semua Tanda Masalah</button>
<button id="downloadLog" class="btn" style="margin-left:10px;">Download Log</button>

<div id="dashboard" class="card-container">
    <div class="card"><div class="card-title">Total Perangkat</div><span id="totalPerangkat">-</span></div>
    <div class="card"><div class="card-title">Windows</div><span id="totalWindows">-</span></div>
    <div class="card"><div class="card-title">Chromebook</div><span id="totalChromebook">-</span></div>

    <div class="card"><div class="card-title">Normal</div><span id="normalCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Ringan</div><span id="ringanCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Berat</div><span id="beratCount">-</span></div>

    <div class="card"><div class="card-title">Butuh Mouse</div><span id="mouseNeed">-</span></div>
    <div class="card"><div class="card-title">Butuh Keyboard</div><span id="keyboardNeed">-</span></div>
</div>

<h2 style="color:#0056b3;margin-top:35px;">üìç Peta Meja Lab 2</h2>
<div id="mapGrid"></div>

<div id="detailBox"></div>

<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script>
/* ============================================================
   DATA LOGIN WIFI 36 MEJA (OTOMATIS)
============================================================ */
const WIFI = {};
for(let i=1;i<=36;i++){
    WIFI[i] = { user: i+"lab2", pass: String(i) };
}

/* ============================================================
   DATA LOGIN BELAJAR.ID CHROMEBOOK
   (dipakai hanya jika OS = Chromebook)
============================================================ */
const CHROME_ACCOUNTS = [
    "putri.wika67@smp.belajar.id",
"kallista.putri192@smp.belajar.id",
"yulia.al83@smp.belajar.id",
"nazril.hidayatullah18@smp.belajar.id",
"muhammad.febri1219@smp.belajar.id",
"muhamad.rizkan48@smp.belajar.id",
"safania.52@smp.belajar.id",
"nia.hidayati013@smp.belajar.id",
"nayilla_azzahra25@smp.belajar.id",
"widya.setya31@smp.belajar.id",
"yusuf.fahreza18@smp.belajar.id",
"muhamad.arif3591@smp.belajar.id",
"muhamad.faiz3380@smp.belajar.id",
"muhammad.khairul8017@smp.belajar.id",
"aisyatul.maulida49@smp.belajar.id"
];
const CHROME_PASS = "Belajar2025!";


/* ============================================================
   LOCAL STORAGE (mark & log harian)
============================================================ */
const LS_MARK = "lab2_marked";
const LS_LOG_PREFIX = "lab2_log_";
let MARKED = JSON.parse(localStorage.getItem(LS_MARK) || "{}");


function todayKey(){
    return LS_LOG_PREFIX + new Date().toISOString().split("T")[0];
}
function appendLog(meja, text){
    const key = todayKey();
    let log = localStorage.getItem(key) || "";
    log += `${new Date().toLocaleString("id-ID")} | Meja ${meja} | ${text}\n`;
    localStorage.setItem(key, log);
}
function getAllLogs(){
    let full = "";
    for(let i=0;i<localStorage.length;i++){
        const key = localStorage.key(i);
        if(key.startsWith(LS_LOG_PREFIX)){
            full += "=== " + key.replace(LS_LOG_PREFIX,"Tanggal: ") + " ===\n";
            full += localStorage.getItem(key) + "\n\n";
        }
    }
    return full || "Belum ada log...";
}


/* ============================================================
   LOAD DATA INVENTARIS (EXCEL)
============================================================ */
let INV = [];

async function loadExcel() {
    const res = await fetch("assets/inventarislab2.xlsx");
    const buf = await res.arrayBuffer();
    const wb = XLSX.read(buf, { type: "array" });
    INV = XLSX.utils.sheet_to_json(wb.Sheets["INV"]);
    updateDashboard();
    renderMap();
}
loadExcel();


/* ============================================================
   DASHBOARD
============================================================ */
function updateDashboard() {
    const win = INV.filter(x => (x.OS||"").toLowerCase().includes("windows"));
    const chrome = INV.filter(x => (x.OS||"").toLowerCase().includes("chrome"));

    document.getElementById("totalPerangkat").innerText = win.length + chrome.length;
    document.getElementById("totalWindows").innerText = win.length;
    document.getElementById("totalChromebook").innerText = chrome.length;

    document.getElementById("normalCount").innerText = INV.filter(x=> (x.Kondisi||"").toLowerCase()==="normal").length;
    document.getElementById("ringanCount").innerText = INV.filter(x=> (x.Kondisi||"").toLowerCase().includes("ringan")).length;
    document.getElementById("beratCount").innerText  = INV.filter(x=> (x.Kondisi||"").toLowerCase().includes("berat")).length;

    document.getElementById("mouseNeed").innerText = INV.filter(x=> (x.Mouse||"").toLowerCase()==="tidak").length;
    document.getElementById("keyboardNeed").innerText = INV.filter(x=> (x.Keyboard||"").toLowerCase()==="tidak").length;
}


/* ============================================================
   RENDER MAP
============================================================ */
function renderMap(){
    const grid=document.getElementById("mapGrid");
    grid.innerHTML="";

    const rows=[
        [22,21,20,19,18,17,"",4,3,2,1],
        [28,27,26,25,24,23,"",8,7,6,5],
        [34,33,32,31,30,29,"",12,11,10,9],
        [40,39,38,37,36,35,"",16,15,14,13]
    ];

    rows.forEach(r=>{
        r.forEach(meja=>{
            const d=document.createElement("div");
            if(meja===""){ d.className="meja kosong"; grid.appendChild(d); return;}

            const item=INV.find(x=>Number(x["NO MEJA"])===Number(meja));
            let cls="kosong";
            if(item){
                let k=(item.Kondisi||"").toLowerCase();
                if(MARKED[meja]) cls="marked";
                else if(k==="normal") cls="normal";
                else if(k.includes("ringan")) cls="ringan";
                else if(k.includes("berat")) cls="berat";
            }

            d.className="meja "+cls;
            d.textContent=meja;
            d.onclick=()=>showDetail(meja);
            grid.appendChild(d);
        });
    });
}


/* ============================================================
   DETAIL POPUP
============================================================ */
function showDetail(no){
    const box=document.getElementById("detailBox");
    const item=INV.find(x=>String(x["NO MEJA"])===String(no));
    box.style.display="block";

    let wifiUser=WIFI[no].user;
    let wifiPass=WIFI[no].pass;

    let isChrome=(item.OS||"").toLowerCase().includes("chrome");
    let belajarUser = isChrome ? CHROME_ACCOUNTS[(no-1)%15] : "-";
    let belajarPass = isChrome ? CHROME_PASS : "-";

    box.innerHTML=`
    <h3>Detail Meja ${no}</h3>
    <b>Wifi User:</b> ${wifiUser}<br>
    <b>Wifi Pass:</b> ${wifiPass}<br><br>

    <b>Akun Belajar.ID:</b> ${belajarUser}<br>
    <b>Password:</b> ${belajarPass}<br><br>

    <b>Merek / Tipe:</b> ${item["Merek / Tipe"]||"-"}<br>
    <b>Processor:</b> ${item["Processor"]||"-"}<br>
    <b>RAM:</b> ${item["RAM"]||"-"}<br>
    <b>Storage:</b> ${item["Storage"]||"-"}<br>
    <b>Kondisi:</b> ${item["Kondisi"]||"-"}<br>
    <b>Keterangan:</b> ${item["Keterangan"]||"-"}<br><br>

    <button id="btnMark${no}" class="btn" style="background:#7a00ff;color:white;border:none;">Tandai Masalah</button>
    <button class="btn" onclick="document.getElementById('detailBox').style.display='none'">Tutup</button>
    `;

    document.getElementById(`btnMark${no}`).onclick=()=>{
        const note=prompt("Tuliskan kendala di meja "+no+" :");
        if(!note) return;
        MARKED[no]=note;
        localStorage.setItem(LS_MARK,JSON.stringify(MARKED));
        appendLog(no,note);
        box.style.display="none";
        renderMap();
    }
}


/* ============================================================
   RESET DAN DOWNLOAD LOG
============================================================ */
document.getElementById("resetMark").onclick=()=>{
    if(!confirm("Yakin ingin menghapus semua tanda masalah?"))return;
    localStorage.removeItem(LS_MARK);
    MARKED={};
    renderMap();
    alert("Semua tanda masalah sudah dihapus.");
};

document.getElementById("downloadLog").onclick=()=>{
    const text=getAllLogs();
    const blob=new Blob([text],{type:"text/plain"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="log_lab2.txt";
    a.click();
};

</script>
</body>
</html>
