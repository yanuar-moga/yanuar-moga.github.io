<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aplikasi Penilaian Karakter Siswa</title>

<!-- LIBRARY -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- ===== STYLE HEADER MODERN ===== -->
<style>
body {
  font-family: "Poppins", Arial, sans-serif;
  margin: 0;
  background: #f0f4f8;
  color: #222;
}
header {
  background: linear-gradient(135deg, #1d72b8, #155a8a);
  color: white;
  text-align: center;
  padding: 20px 10px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.15);
}
header img {
  width: 60px;
  vertical-align: middle;
  border-radius: 50%;
  margin-right: 10px;
}
header h1 {
  font-size: 22px;
  margin: 5px 0 0;
}
header p {
  margin: 4px 0 0;
  font-size: 13px;
  opacity: 0.85;
}

/* ===== KONTEN ===== */
.container{
  max-width:1400px;
  margin:25px auto;
  padding:20px;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:20px;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
}
button{
  padding:10px 16px;
  border:none;
  background:#1d72b8;
  color:#fff;
  border-radius:6px;
  cursor:pointer;
}
button:hover{background:#155a8a}

/* ===== AREA PDF (AUTO MARGIN) ===== */
#pdfArea{
  padding:1.5cm;
  box-sizing:border-box;
}

/* ===== KOP PDF ===== */
.kop{
  display:flex;
  align-items:center;
  border-bottom:3px solid #000;
  padding-bottom:10px;
  margin-bottom:15px;
}
.kop img{
  width:90px;
  margin-right:15px;
}
.kop-text{
  width:100%;
  text-align:center;
  line-height:1.3;
}
.kop-text div{font-weight:bold;font-size:14px}
.kop-text .judul{font-size:16px}
.kop-text .alamat{font-size:12px;font-weight:normal}

/* ===== TABEL ===== */
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
  table-layout:fixed;
}
th,td{
  border:1px solid #333;
  padding:8px;
  vertical-align:top;
  word-wrap:break-word;
}
th{
  background:#34495e;
  color:#fff;
  text-align:center;
}
tr{page-break-inside:avoid}

/* ===== BADGE ===== */
.badge{
  padding:4px 8px;
  border-radius:6px;
  font-size:11px;
  display:inline-block;
}
.good{background:#2ecc71;color:#fff}
.mid{background:#f1c40f;color:#000}
.low{background:#e74c3c;color:#fff}
</style>
</head>

<body>

<header>
  <img src="assets/logo.jpg">
  <h1>Aplikasi Penilaian Karakter Siswa</h1>
  <p>Analisis Otomatis Berbasis Data Excel • SMP Negeri 1 Moga</p>
</header>

<div class="container">
<div class="card">

<input type="file" id="excelFile">
<button onclick="downloadPDF()">⬇ Download PDF</button>

<div id="pdfArea">

<div class="kop">
  <img src="assets/logo.png">
  <div class="kop-text">
    <div>PEMERINTAH KABUPATEN PEMALANG</div>
    <div>DINAS PENDIDIKAN DAN KEBUDAYAAN</div>
    <div>PANITIA ASESMEN SUMATIF AKHIR SEMESTER</div>
    <div class="judul">SMP NEGERI 1 MOGA</div>
    <div>TAHUN AJARAN 2025/2026</div>
    <div class="alamat">
      Jalan Simpang Tiga Telp (0284) 583367 Pemalang 52354
    </div>
  </div>
</div>

<div id="hasil"></div>

</div>
</div>
</div>

<script>
function kategoriNilai(avg){
  if(avg>=85) return {t:"Sangat Baik",c:"good"};
  if(avg>=75) return {t:"Baik",c:"mid"};
  return {t:"Perlu Pendampingan",c:"low"};
}

function mapPancasila(avg,alpa,eks){
  return `
  • Beriman & Berakhlak Mulia: ${alpa===0?"Sangat Baik":"Perlu Pembinaan"}<br>
  • Mandiri: ${avg>=80?"Mandiri":"Perlu Pendampingan"}<br>
  • Gotong Royong: ${eks?"Aktif":"Perlu Penguatan"}<br>
  • Bernalar Kritis: ${avg>=85?"Sangat Baik":"Perlu Latihan"}
  `;
}

document.getElementById("excelFile").addEventListener("change",function(){
  const reader=new FileReader();
  reader.onload=e=>{
    const wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
    const sh=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{header:1});

    let html=`<table>
    <tr>
      <th>Nama</th>
      <th>Perkembangan</th>
      <th>Kekurangan</th>
      <th>Saran</th>
      <th>Informasi untuk Orang Tua</th>
      <th>Profil Pelajar Pancasila</th>
    </tr>`;

    for(let i=7;i<=38;i++){
      if(!sh[i]||!sh[i][1])continue;

      let nilai=sh[i].slice(4,15).filter(n=>typeof n==="number");
      let avg=nilai.reduce((a,b)=>a+b,0)/nilai.length||0;
      let alpa=sh[i][17]||0;
      let eks=sh[i].slice(18,25).filter(x=>x&&x!=="-").length>=2;
      let k=kategoriNilai(avg);

      html+=`
      <tr>
        <td><b>${sh[i][1]}</b></td>
        <td><span class="badge ${k.c}">${k.t}</span><br>Rata-rata ${avg.toFixed(1)}</td>
        <td>
          ${avg<75?"Akademik<br>":""}
          ${alpa>3?"Disiplin<br>":""}
          ${!eks?"Minat & Bakat":""}
        </td>
        <td>
          Pendampingan belajar teratur, pembiasaan disiplin,
          dan dukungan kegiatan positif sesuai minat.
        </td>
        <td>
          1. Perkembangan ${k.t.toLowerCase()} di sekolah.<br>
          2. Orang tua dapat mendampingi belajar rutin di rumah.<br>
          3. Disarankan mengikuti kegiatan literasi dan ekstrakurikuler.
        </td>
        <td>${mapPancasila(avg,alpa,eks)}</td>
      </tr>`;
    }

    html+=`</table>`;
    document.getElementById("hasil").innerHTML=html;
  };
  reader.readAsArrayBuffer(this.files[0]);
});

function downloadPDF(){
  html2pdf().from(document.getElementById("pdfArea")).set({
    filename:"Laporan_Perkembangan_Siswa_7H.pdf",
    html2canvas:{scale:1.6,useCORS:true},
    jsPDF:{format:"a4",orientation:"landscape"},
    pagebreak:{mode:["avoid-all","css","legacy"]}
  }).save();
}
</script>

</body>
</html>
